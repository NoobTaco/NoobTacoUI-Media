PACKAGER_URL := https://raw.githubusercontent.com/BigWigsMods/packager/master/release.sh
PROJECT_ROOT := ../..

.PHONY: libs all clean test package

all: test

libs:
	@echo "üì• Updating libraries using BigWigsMods packager..."
	cd $(PROJECT_ROOT) && curl -s $(PACKAGER_URL) | bash -s -- -c -d -z
	@if [ -d "$(PROJECT_ROOT)/.release/NoobTacoUI-Media/Libraries/LibSharedMedia-3.0" ]; then \
		echo "üì¶ Installing LibSharedMedia-3.0..."; \
		rm -rf $(PROJECT_ROOT)/Libraries/LibSharedMedia-3.0; \
		cp -r $(PROJECT_ROOT)/.release/NoobTacoUI-Media/Libraries/LibSharedMedia-3.0 $(PROJECT_ROOT)/Libraries/; \
		echo "‚úÖ Libraries updated successfully!"; \
	else \
		echo "‚ùå Failed to update libraries"; \
		exit 1; \
	fi
	@rm -rf $(PROJECT_ROOT)/.release

package:
	@echo "üì¶ Building addon package with version replacement..."
	@echo "Current git version: $$(cd $(PROJECT_ROOT) && git describe --tags --always)"
	cd $(PROJECT_ROOT) && curl -s $(PACKAGER_URL) | bash -s -- -d -z
	@echo "‚úÖ Package created in .release directory"

clean:
	@echo "üßπ Cleaning up temporary files..."
	@rm -rf $(PROJECT_ROOT)/.release $(PROJECT_ROOT)/.pkgmeta

test:
	@echo "üß™ Testing addon structure..."
	@if [ -f "$(PROJECT_ROOT)/NoobTacoUI-Media.toc" ]; then \
		echo "‚úÖ TOC file exists"; \
	else \
		echo "‚ùå TOC file missing"; \
		exit 1; \
	fi
	@if [ -f "$(PROJECT_ROOT)/Libraries/LibSharedMedia-3.0/LibSharedMedia-3.0/LibSharedMedia-3.0.lua" ]; then \
		echo "‚úÖ LibSharedMedia-3.0 properly installed"; \
	else \
		echo "‚ùå LibSharedMedia-3.0 missing or incomplete"; \
		exit 1; \
	fi
	@echo "Current git version: $$(cd $(PROJECT_ROOT) && git describe --tags --always)"
	@echo "‚úÖ All tests passed!"
